<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tasty.app.module.review.repository.mapper.ReviewMapper">

  <!-- 리뷰 등록 -->
  <insert id="insertOne" useGeneratedKeys="true" keyProperty="reviewId">
    insert into review (title, content, store_name, store_address, thumbnail_url, thumbnail_file_name, star, good, hits)
    values (#{title}, #{content}, #{storeName}, #{storeAddress}, #{thumbnailUrl}, #{thumbnailFileName}, #{star}, #{good}, #{hits})
  </insert>

  <!-- 리뷰 조회 -->
  <select id="selectOneById" resultType="com.tasty.app.module.review.domain.Review">
    select *
    from review
    where review_id = #{reviewId}
  </select>

  <!-- 총 리뷰 수 -->
  <select id="countAll" resultType="int">
    select count(review_id)
    from review
  </select>

  <!-- 리뷰 목록 -->
  <select id="selectAll" resultType="com.tasty.app.module.review.domain.Review">
    select *
    from review
    <where>
      <if test="search != null and search !=''">
        and title like concat('%', #{search}, '%')
        or content like concat('%', #{search}, '%')
      </if>
    </where>
    <trim prefix="order by">
      <!-- sortOption: 전체 (0), 최근 순 (1), 평점 순 (2) -->
      <if test="sortOption == 0"> review_id desc</if>
      <if test="sortOption == 1"> review_id desc</if>
      <if test="sortOption == 2"> star desc</if>
    </trim>
    limit #{pageable.offset}, #{pageable.size}
  </select>

  <!-- 리뷰 수정 -->
  <update id="updateOneById">
    update review
    set title = #{params.review.title},
        content = #{params.review.content},
        store_name = #{params.review.storeName},
        store_address = #{params.review.storeAddress},
        thumbnail_url = #{params.review.thumbnailUrl},
        thumbnail_file_name = #{params.review.thumbnailFileName},
        star = #{params.review.star}
    where review_id = #{params.reviewId}
  </update>

  <!-- 리뷰 삭제 -->
  <delete id="deleteOne">
    delete from review
    where review_id = #{reviewId}
  </delete>
</mapper>